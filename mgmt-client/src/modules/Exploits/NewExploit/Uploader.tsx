import { DropzoneArea } from 'mui-file-dropzone';
import useFiles from 'utils/useFiles';

export default function Uploader({ className }: { className: string }) {
  const { setTar, addFile } = useFiles();

  const addFileFunc = async (newFiles: File[]) => {
    if (newFiles.length === 1 && newFiles[0].name.endsWith('.tar')) {
      if (
        !confirm(
          'Are you sure you want to upload a tar-file?\nYour current files will be overwritten.'
        )
      )
        return;
      await setTar(await newFiles[0].arrayBuffer());
      return;
    }
    newFiles.forEach(async (file) => {
      addFile({
        name: file.name,
        data: await file.arrayBuffer(),
      });
    });
  };

  return (
    <DropzoneArea
      onDrop={addFileFunc}
      fileObjects={null}
      showFileNames
      dropzoneText="Drag your files here, click and select, or upload a tar-file"
      dropzoneClass={`text-gray-600 !bg-gray-200 ${className}`}
      filesLimit={100}
      showPreviewsInDropzone={false}
    />
  );
}
