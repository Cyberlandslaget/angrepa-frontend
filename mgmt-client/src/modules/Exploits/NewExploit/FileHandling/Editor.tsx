import EditorComponent from '@monaco-editor/react';
import useFiles from 'utils/useFiles';

export default function Editor() {
  const { getSelectedFile, updateFile } = useFiles();
  const selectedFile = getSelectedFile();

  if (!selectedFile) return <h2>No file selected.</h2>;

  const decoder = new TextDecoder('utf-8', { fatal: true });
  const encoder = new TextEncoder();
  let text: string;
  try {
    text = decoder.decode(selectedFile?.data);
  } catch (e) {
    return <h2>Cannot edit as text.</h2>;
  }

  const onChange = (value: string | undefined, event: unknown) => {
    if (!value || !selectedFile?.name) return;
    const data = encoder.encode(value);
    updateFile(selectedFile?.name, data);
  };

  return (
    <EditorComponent
      value={text}
      path={selectedFile?.name}
      theme="vs-dark"
      onChange={onChange}
    />
  );
}
