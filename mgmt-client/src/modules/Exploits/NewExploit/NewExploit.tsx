import NewExploitHeader from './NewExploitHeader';
import FileEditor from './FileHandling/FileEditor';
import { useEffect, useMemo } from 'react';
import useFiles from 'utils/useFiles';
import { useLocation } from 'react-router-dom';

export default function NewExploit() {
  const { setFiles } = useFiles();
  const textEncoder = useMemo(() => new TextEncoder(), []);
  const location = useLocation();

  useEffect(() => {
    if (location?.state?.files) setFiles(location.state.files);
    else {
      setFiles([
        {
          name: 'config.json',
          data: textEncoder.encode(`{
  "service": "httpchal1",
  "blacklist": ["10.1.1.2", "10.1.1.3"]
}`),
        },
      ]);
    }
  }, [location?.state?.files, setFiles, textEncoder]);

  return (
    <div className="w-full h-full grid grid-flow-row [grid-template-rows:6rem_1fr] gap-3">
      <NewExploitHeader />
      <FileEditor />
    </div>
  );
}
